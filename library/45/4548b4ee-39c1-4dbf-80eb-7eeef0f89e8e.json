{
  "__type__": "cc.TextAsset",
  "_name": "README",
  "_objFlags": 0,
  "__editorExtras__": {},
  "_native": "",
  "text": "# 卡牌游戏数据管理架构说明\r\n\r\n## 概述\r\n\r\n本项目实现了统一的数据管理架构，将静态配置、动态运行时数据和通用工具方法进行了模块化封装。\r\n\r\n## 核心模块\r\n\r\n### 1. DataManager (数据管理器)\r\n**位置**: `assets/Classes/managers/DataManager.ts`\r\n\r\n**功能**:\r\n- 统一管理静态关卡配置数据\r\n- 管理运行时动态数据（桌面牌、手牌）\r\n- 支持操作步骤的保存和撤销\r\n- 提供便捷的卡牌查询接口\r\n\r\n**主要方法**:\r\n```typescript\r\n// 加载关卡\r\nawait DataManager.instance.loadLevel(levelId: number)\r\n\r\n// 获取桌面卡牌\r\nDataManager.instance.tableCards\r\n\r\n// 获取手牌\r\nDataManager.instance.handCards\r\n\r\n// 获取手牌最后一张\r\nDataManager.instance.getLastHandCard()\r\n\r\n// 判断两张牌是否可以匹配（点数绝对值差1）\r\nDataManager.instance.canMatch(tableCard, handCard)\r\n\r\n// 执行匹配操作\r\nDataManager.instance.executeMatch(tableCardId: string)\r\n\r\n// 替换手牌最后一张\r\nDataManager.instance.replaceLastHandCard(cardId: string)\r\n\r\n// 撤销上一步操作\r\nDataManager.instance.undo()\r\n\r\n// 检查是否可以撤销\r\nDataManager.instance.canUndo()\r\n\r\n// 清空历史记录\r\nDataManager.instance.clearHistory()\r\n\r\n// 获取历史记录数量\r\nDataManager.instance.getHistoryCount()\r\n```\r\n\r\n### 2. CardUtils (卡牌工具类)\r\n**位置**: `assets/Classes/utils/CardUtils.ts`\r\n\r\n**功能**:\r\n- 提供卡牌相关的通用工具方法\r\n- 判断花色颜色、获取卡牌名称等\r\n\r\n**主要方法**:\r\n```typescript\r\n// 判断花色是否为红色\r\nCardUtils.isRedSuit(suit: number)\r\n\r\n// 判断花色是否为黑色\r\nCardUtils.isBlackSuit(suit: number)\r\n\r\n// 获取花色符号（♣、♦、♥、♠）\r\nCardUtils.getSuitSymbol(suit: number)\r\n\r\n// 获取点数文本（A、2-10、J、Q、K）\r\nCardUtils.getFaceText(face: number)\r\n\r\n// 获取卡牌完整名称（如：♣A）\r\nCardUtils.getCardName(suit: number, face: number)\r\n\r\n// 获取点数对应的数组索引（0-12）\r\nCardUtils.getFaceIndex(face: number)\r\n\r\n// 判断是否为花牌（J、Q、K）\r\nCardUtils.isFaceCard(face: number)\r\n\r\n// 判断是否为A\r\nCardUtils.isAce(face: number)\r\n\r\n// 获取点数的数值\r\nCardUtils.getFaceValue(face: number)\r\n\r\n// 比较两张牌的点数大小\r\nCardUtils.compareFace(face1: number, face2: number)\r\n```\r\n\r\n### 3. RuntimeCardData (运行时卡牌数据)\r\n**位置**: `assets/Classes/models/RuntimeCardData.ts`\r\n\r\n**功能**:\r\n- 继承静态配置数据\r\n- 管理卡牌的动态状态\r\n- 支持单张卡牌的状态保存和回退\r\n\r\n**主要属性**:\r\n```typescript\r\n// 卡牌唯一ID\r\npublic readonly id: string\r\n\r\n// 静态配置数据\r\npublic readonly config: CardConfig\r\n\r\n// 是否正面朝上\r\npublic isFaceUp: boolean\r\n\r\n// 是否被锁定（不可移动）\r\npublic isLocked: boolean\r\n\r\n// 当前所在区域（table/hand等）\r\npublic currentArea: string\r\n\r\n// 当前位置\r\npublic position: { x: number; y: number }\r\n\r\n// 层级\r\npublic zIndex: number\r\n```\r\n\r\n**主要方法**:\r\n```typescript\r\n// 保存当前状态到历史记录\r\ncardData.saveState()\r\n\r\n// 回退到上一个状态\r\ncardData.restoreState()\r\n\r\n// 清空历史记录\r\ncardData.clearHistory()\r\n\r\n// 获取历史记录数量\r\ncardData.getHistoryCount()\r\n```\r\n\r\n### 4. LevelController (关卡控制器)\r\n**位置**: `assets/Classes/controllers/LevelController_new.ts`\r\n\r\n**功能**:\r\n- 管理卡牌视图的创建和更新\r\n- 处理卡牌点击事件\r\n- 协调数据管理和视图更新\r\n\r\n**主要方法**:\r\n```typescript\r\n// 处理桌面卡牌点击事件\r\nonTableCardClick(cardNode: Node)\r\n\r\n// 处理手牌点击事件\r\nonHandCardClick(cardNode: Node)\r\n\r\n// 撤销上一步操作\r\nonUndoClick()\r\n```\r\n\r\n## 游戏流程\r\n\r\n### 1. 初始化流程\r\n```typescript\r\n// 1. 初始化游戏配置\r\nawait GameConfig.instance.initialize()\r\n\r\n// 2. 加载关卡\r\nawait DataManager.instance.loadLevel(1)\r\n\r\n// 3. 创建卡牌视图\r\nthis.createCardsFromData()\r\n```\r\n\r\n### 2. 匹配流程\r\n```typescript\r\n// 1. 玩家点击桌面卡牌\r\nonTableCardClick(cardNode)\r\n\r\n// 2. 检查是否可以匹配\r\nif (DataManager.instance.canMatch(tableCard, handCard)) {\r\n    // 3. 执行匹配操作\r\n    DataManager.instance.executeMatch(tableCardId)\r\n    // 4. 更新视图\r\n    refreshCardDisplay(cardNode, cardData)\r\n    removeLastHandCardView()\r\n}\r\n```\r\n\r\n### 3. 替换流程\r\n```typescript\r\n// 1. 玩家点击手牌\r\nonHandCardClick(cardNode)\r\n\r\n// 2. 执行替换操作\r\nif (DataManager.instance.replaceLastHandCard(cardId)) {\r\n    // 3. 更新视图\r\n    refreshHandCardsDisplay()\r\n}\r\n```\r\n\r\n### 4. 撤销流程\r\n```typescript\r\n// 1. 玩家点击撤销按钮\r\nonUndoClick()\r\n\r\n// 2. 执行撤销操作\r\nif (DataManager.instance.undo()) {\r\n    // 3. 更新视图\r\n    refreshAllCardsDisplay()\r\n}\r\n```\r\n\r\n## 数据结构\r\n\r\n### 静态配置 (CardConfig)\r\n```typescript\r\ninterface CardConfig {\r\n    CardFace: number;  // 点数（1-13）\r\n    CardSuit: number;  // 花色（0-3）\r\n    Position: {\r\n        x: number;\r\n        y: number;\r\n    };\r\n}\r\n```\r\n\r\n### 运行时数据 (RuntimeCardData)\r\n```typescript\r\nclass RuntimeCardData {\r\n    id: string\r\n    config: CardConfig\r\n    isFaceUp: boolean\r\n    isLocked: boolean\r\n    currentArea: string\r\n    position: { x: number; y: number }\r\n    zIndex: number\r\n}\r\n```\r\n\r\n## 注意事项\r\n\r\n1. **数据同步**: 所有卡牌数据的修改都应该通过DataManager进行，确保数据一致性\r\n2. **视图更新**: 数据修改后需要手动刷新对应的视图\r\n3. **历史记录**: 历史记录默认最多保存50步，可以通过修改`_maxHistorySize`调整\r\n4. **卡牌ID**: 卡牌ID在创建时自动生成，格式为`table_${index}`或`hand_${index}`\r\n\r\n## 扩展建议\r\n\r\n1. 添加更多游戏操作类型（如：移动、翻转等）\r\n2. 实现多关卡进度保存\r\n3. 添加游戏状态持久化\r\n4. 优化历史记录的存储方式，减少内存占用\r\n"
}