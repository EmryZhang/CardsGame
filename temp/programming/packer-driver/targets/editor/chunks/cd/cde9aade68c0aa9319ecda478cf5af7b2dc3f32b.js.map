{"version":3,"sources":["file:///D:/Work/job/CardsGame/assets/Classes/models/UndoModel.ts"],"names":["UndoModel","ActionType","constructor","maxHistorySize","_actionHistory","_maxHistorySize","saveAction","action","cardsState","push","length","shift","getLastAction","undefined","undo","pop","clearHistory","getHistoryCount","canUndo","getAllHistory"],"mappings":";;;8BA6BaA,S;;;;;;;;;;;;;;;;;;;AA3Bb;AACA;AACA;4BACYC,U,0BAAAA,U;AAAAA,QAAAA,U;AAAAA,QAAAA,U;eAAAA,U;;AAKZ;AACA;AACA;;AAMA;AACA;AACA;;;AAMA;AACA;AACA;2BACaD,S,GAAN,MAAMA,SAAN,CAAgB;AAInBE,QAAAA,WAAW,CAACC,cAAsB,GAAG,EAA1B,EAA8B;AAAA,eAHjCC,cAGiC,GAHA,EAGA;AAAA,eAFjCC,eAEiC,GAFP,EAEO;AACrC,eAAKA,eAAL,GAAuBF,cAAvB;AACH,SANkB,CAQnB;;;AACOG,QAAAA,UAAU,CAACC,MAAD,EAAqBC,UAArB,EAA+D;AAC5E,eAAKJ,cAAL,CAAoBK,IAApB,CAAyB;AAAEF,YAAAA,MAAF;AAAUC,YAAAA;AAAV,WAAzB;;AACA,cAAI,KAAKJ,cAAL,CAAoBM,MAApB,GAA6B,KAAKL,eAAtC,EAAuD;AACnD,iBAAKD,cAAL,CAAoBO,KAApB;AACH;AACJ,SAdkB,CAgBnB;;;AACOC,QAAAA,aAAa,GAA6B;AAC7C,cAAI,KAAKR,cAAL,CAAoBM,MAApB,KAA+B,CAAnC,EAAsC,OAAOG,SAAP;AACtC,iBAAO,KAAKT,cAAL,CAAoB,KAAKA,cAAL,CAAoBM,MAApB,GAA6B,CAAjD,CAAP;AACH,SApBkB,CAsBnB;;;AACOI,QAAAA,IAAI,GAA6B;AACpC,cAAI,KAAKV,cAAL,CAAoBM,MAApB,KAA+B,CAAnC,EAAsC,OAAOG,SAAP;AACtC,iBAAO,KAAKT,cAAL,CAAoBW,GAApB,EAAP;AACH,SA1BkB,CA4BnB;;;AACOC,QAAAA,YAAY,GAAS;AACxB,eAAKZ,cAAL,GAAsB,EAAtB;AACH,SA/BkB,CAiCnB;;;AACOa,QAAAA,eAAe,GAAW;AAC7B,iBAAO,KAAKb,cAAL,CAAoBM,MAA3B;AACH,SApCkB,CAsCnB;;;AACOQ,QAAAA,OAAO,GAAY;AACtB,iBAAO,KAAKd,cAAL,CAAoBM,MAApB,GAA6B,CAApC;AACH,SAzCkB,CA2CnB;;;AACOS,QAAAA,aAAa,GAAmB;AACnC,iBAAO,CAAC,GAAG,KAAKf,cAAT,CAAP;AACH;;AA9CkB,O","sourcesContent":["import { CardState } from './CardModel';\r\n\r\n/**\r\n * 操作类型枚举\r\n */\r\nexport enum ActionType {\r\n    MATCH = 'match',     // 匹配\r\n    REPLACE = 'replace'  // 替换\r\n}\r\n\r\n/**\r\n * 游戏操作接口\r\n */\r\nexport interface GameAction {\r\n    type: ActionType;\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * 操作记录接口\r\n */\r\nexport interface ActionRecord {\r\n    action: GameAction;\r\n    cardsState: Map<string, CardState>;\r\n}\r\n\r\n/**\r\n * 回退模型\r\n */\r\nexport class UndoModel {\r\n    private _actionHistory: ActionRecord[] = [];\r\n    private _maxHistorySize: number = 50;\r\n\r\n    constructor(maxHistorySize: number = 50) {\r\n        this._maxHistorySize = maxHistorySize;\r\n    }\r\n\r\n    // 保存操作记录\r\n    public saveAction(action: GameAction, cardsState: Map<string, CardState>): void {\r\n        this._actionHistory.push({ action, cardsState });\r\n        if (this._actionHistory.length > this._maxHistorySize) {\r\n            this._actionHistory.shift();\r\n        }\r\n    }\r\n\r\n    // 获取上一步操作\r\n    public getLastAction(): ActionRecord | undefined {\r\n        if (this._actionHistory.length === 0) return undefined;\r\n        return this._actionHistory[this._actionHistory.length - 1];\r\n    }\r\n\r\n    // 撤销上一步操作\r\n    public undo(): ActionRecord | undefined {\r\n        if (this._actionHistory.length === 0) return undefined;\r\n        return this._actionHistory.pop();\r\n    }\r\n\r\n    // 清空历史记录\r\n    public clearHistory(): void {\r\n        this._actionHistory = [];\r\n    }\r\n\r\n    // 获取历史记录数量\r\n    public getHistoryCount(): number {\r\n        return this._actionHistory.length;\r\n    }\r\n\r\n    // 检查是否可以撤销\r\n    public canUndo(): boolean {\r\n        return this._actionHistory.length > 0;\r\n    }\r\n\r\n    // 获取所有历史记录\r\n    public getAllHistory(): ActionRecord[] {\r\n        return [...this._actionHistory];\r\n    }\r\n}\r\n"]}