{"version":3,"sources":["file:///D:/Work/job/CardsGame/assets/Classes/models/UndoModel.ts"],"names":["UndoModel","ActionType","constructor","maxHistorySize","_actionHistory","_maxHistorySize","saveAction","action","cardsState","push","length","shift","getLastAction","undefined","undo","pop","clearHistory","getHistoryCount","canUndo","getAllHistory"],"mappings":";;;8BA8BaA,S;;;;;;;;;;;;;;;;;;AA9Bb;AACA;AACA;AACA;;;AAGA;AACA;AACA;4BACYC,U,0BAAAA,U;AAAAA,QAAAA,U;AAAAA,QAAAA,U;eAAAA,U;;AAKZ;AACA;AACA;;AAMA;AACA;AACA;;;2BAMaD,S,GAAN,MAAMA,SAAN,CAAgB;AAOnBE,QAAAA,WAAW,CAACC,cAAD,EAA8B;AAAA,cAA7BA,cAA6B;AAA7BA,YAAAA,cAA6B,GAAJ,EAAI;AAAA;;AANzC;AAMyC,eALjCC,cAKiC,GALA,EAKA;AAHzC;AAGyC,eAFjCC,eAEiC,GAFP,EAEO;AACrC,eAAKA,eAAL,GAAuBF,cAAvB;AACH;AAED;AACJ;AACA;;;AACWG,QAAAA,UAAU,CAACC,MAAD,EAAqBC,UAArB,EAA+D;AAC5E;AACA,eAAKJ,cAAL,CAAoBK,IAApB,CAAyB;AACrBF,YAAAA,MAAM,EAAEA,MADa;AAErBC,YAAAA,UAAU,EAAEA;AAFS,WAAzB,EAF4E,CAO5E;;;AACA,cAAI,KAAKJ,cAAL,CAAoBM,MAApB,GAA6B,KAAKL,eAAtC,EAAuD;AACnD,iBAAKD,cAAL,CAAoBO,KAApB;AACH;AACJ;AAED;AACJ;AACA;;;AACWC,QAAAA,aAAa,GAA6B;AAC7C,cAAI,KAAKR,cAAL,CAAoBM,MAApB,KAA+B,CAAnC,EAAsC,OAAOG,SAAP;AACtC,iBAAO,KAAKT,cAAL,CAAoB,KAAKA,cAAL,CAAoBM,MAApB,GAA6B,CAAjD,CAAP;AACH;AAED;AACJ;AACA;AACA;;;AACWI,QAAAA,IAAI,GAA6B;AACpC,cAAI,KAAKV,cAAL,CAAoBM,MAApB,KAA+B,CAAnC,EAAsC,OAAOG,SAAP;AACtC,iBAAO,KAAKT,cAAL,CAAoBW,GAApB,EAAP;AACH;AAED;AACJ;AACA;;;AACWC,QAAAA,YAAY,GAAS;AACxB,eAAKZ,cAAL,GAAsB,EAAtB;AACH;AAED;AACJ;AACA;;;AACWa,QAAAA,eAAe,GAAW;AAC7B,iBAAO,KAAKb,cAAL,CAAoBM,MAA3B;AACH;AAED;AACJ;AACA;;;AACWQ,QAAAA,OAAO,GAAY;AACtB,iBAAO,KAAKd,cAAL,CAAoBM,MAApB,GAA6B,CAApC;AACH;AAED;AACJ;AACA;;;AACWS,QAAAA,aAAa,GAAmB;AACnC,iBAAO,CAAC,GAAG,KAAKf,cAAT,CAAP;AACH;;AAtEkB,O","sourcesContent":["/**\r\n * 回退模型\r\n * 负责管理操作历史和撤销功能\r\n */\r\nimport { CardState } from './CardModel';\r\n\r\n/**\r\n * 游戏操作类型\r\n */\r\nexport enum ActionType {\r\n    MATCH = 'match',      // 匹配操作\r\n    REPLACE = 'replace'   // 替换操作\r\n}\r\n\r\n/**\r\n * 游戏操作接口\r\n */\r\nexport interface GameAction {\r\n    type: ActionType;\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * 操作记录接口\r\n */\r\nexport interface ActionRecord {\r\n    action: GameAction;\r\n    cardsState: Map<string, CardState>;\r\n}\r\n\r\nexport class UndoModel {\r\n    // 操作历史记录\r\n    private _actionHistory: ActionRecord[] = [];\r\n\r\n    // 最大历史记录数\r\n    private _maxHistorySize: number = 50;\r\n\r\n    constructor(maxHistorySize: number = 50) {\r\n        this._maxHistorySize = maxHistorySize;\r\n    }\r\n\r\n    /**\r\n     * 保存操作前的状态\r\n     */\r\n    public saveAction(action: GameAction, cardsState: Map<string, CardState>): void {\r\n        // 保存操作记录\r\n        this._actionHistory.push({\r\n            action: action,\r\n            cardsState: cardsState\r\n        });\r\n\r\n        // 限制历史记录数量\r\n        if (this._actionHistory.length > this._maxHistorySize) {\r\n            this._actionHistory.shift();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取上一步操作\r\n     */\r\n    public getLastAction(): ActionRecord | undefined {\r\n        if (this._actionHistory.length === 0) return undefined;\r\n        return this._actionHistory[this._actionHistory.length - 1];\r\n    }\r\n\r\n    /**\r\n     * 撤销上一步操作\r\n     * @returns 操作记录，如果没有可撤销的操作则返回undefined\r\n     */\r\n    public undo(): ActionRecord | undefined {\r\n        if (this._actionHistory.length === 0) return undefined;\r\n        return this._actionHistory.pop();\r\n    }\r\n\r\n    /**\r\n     * 清空历史记录\r\n     */\r\n    public clearHistory(): void {\r\n        this._actionHistory = [];\r\n    }\r\n\r\n    /**\r\n     * 获取历史记录数量\r\n     */\r\n    public getHistoryCount(): number {\r\n        return this._actionHistory.length;\r\n    }\r\n\r\n    /**\r\n     * 检查是否可以撤销\r\n     */\r\n    public canUndo(): boolean {\r\n        return this._actionHistory.length > 0;\r\n    }\r\n\r\n    /**\r\n     * 获取所有历史记录\r\n     */\r\n    public getAllHistory(): ActionRecord[] {\r\n        return [...this._actionHistory];\r\n    }\r\n}\r\n"]}