{"version":3,"sources":["file:///D:/Work/job/CardsGame/assets/Classes/models/GameModel.ts"],"names":["GameModel","CardModel","constructor","_allCards","Map","_tableCards","_handCards","_topCard","_reserveCards","_initialReserveCards","initialize","levelConfig","clearAll","Playfield","forEach","config","index","card","currentArea","zIndex","set","id","Stack","handCards","Array","from","values","length","slice","clear","allCards","tableCards","getCardById","get","getLastHandCard","cards","topCard","reserveCards","updateTopAndReserveCards","console","log","CardFace","CardSuit","canMatch","tableCard","handCard","Math","abs","executeMatch","tableCardId","delete","replaceLastHandCard","cardId","lastIndex","lastCard","tempZIndex","getAllCardsState","states","face","suit","isFaceUp","isLocked","area","position","restoreAllCardsState","state","recalculateTopAndReserveCards","sort","a","b"],"mappings":"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","sourcesContent":["/**\r\n * 游戏模型\r\n * 负责管理游戏的核心数据和状态\r\n */\r\nimport { CardConfig, LevelConfig } from './CardData';\r\nimport { CardModel, CardState } from './CardModel';\r\n\r\nexport class GameModel {\r\n    // 所有卡牌\r\n    private _allCards: Map<string, CardModel> = new Map();\r\n\r\n    // 桌面卡牌\r\n    private _tableCards: Map<string, CardModel> = new Map();\r\n\r\n    // 手牌\r\n    private _handCards: Map<string, CardModel> = new Map();\r\n\r\n    // 顶牌（手牌区最右边的一张）\r\n    private _topCard: CardModel = null;\r\n\r\n    // 备用牌（手牌区除了顶牌之外的牌）\r\n    private _reserveCards: CardModel[] = [];\r\n\r\n    // 初始备用牌（关卡开始时除了顶牌的所有牌，固定不变）\r\n    private _initialReserveCards: CardModel[] = [];\r\n\r\n    constructor() {\r\n    }\r\n\r\n    /**\r\n     * 初始化游戏数据\r\n     */\r\n    public initialize(levelConfig: LevelConfig): void {\r\n        this.clearAll();\r\n\r\n        // 初始化桌面牌\r\n        if (levelConfig?.Playfield) {\r\n            levelConfig.Playfield.forEach((config, index) => {\r\n                const card = new CardModel(config, `table_${index}`);\r\n                card.currentArea = 'table';\r\n                card.zIndex = index;\r\n                this._tableCards.set(card.id, card);\r\n                this._allCards.set(card.id, card);\r\n            });\r\n        }\r\n\r\n        // 初始化手牌\r\n        if (levelConfig?.Stack) {\r\n            levelConfig.Stack.forEach((config, index) => {\r\n                const card = new CardModel(config, `hand_${index}`);\r\n                card.currentArea = 'hand';\r\n                card.zIndex = index;\r\n                this._handCards.set(card.id, card);\r\n                this._allCards.set(card.id, card);\r\n            });\r\n\r\n            // 设置初始顶牌和初始备用牌\r\n            const handCards = Array.from(this._handCards.values());\r\n            if (handCards.length > 0) {\r\n                this._topCard = handCards[handCards.length - 1];\r\n                this._initialReserveCards = handCards.slice(0, handCards.length - 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清空所有数据\r\n     */\r\n    public clearAll(): void {\r\n        this._allCards.clear();\r\n        this._tableCards.clear();\r\n        this._handCards.clear();\r\n    }\r\n\r\n    /**\r\n     * 获取所有卡牌\r\n     */\r\n    public get allCards(): Map<string, CardModel> {\r\n        return this._allCards;\r\n    }\r\n\r\n    /**\r\n     * 获取桌面卡牌\r\n     */\r\n    public get tableCards(): Map<string, CardModel> {\r\n        return this._tableCards;\r\n    }\r\n\r\n    /**\r\n     * 获取手牌\r\n     */\r\n    public get handCards(): Map<string, CardModel> {\r\n        return this._handCards;\r\n    }\r\n\r\n    /**\r\n     * 根据ID获取卡牌\r\n     */\r\n    public getCardById(id: string): CardModel | undefined {\r\n        return this._allCards.get(id);\r\n    }\r\n\r\n    /**\r\n     * 获取手牌最后一张\r\n     */\r\n    public getLastHandCard(): CardModel | undefined {\r\n        const cards = Array.from(this._handCards.values());\r\n        return cards[cards.length - 1];\r\n    }\r\n\r\n    /**\r\n     * 获取顶牌\r\n     */\r\n    public get topCard(): CardModel {\r\n        return this._topCard;\r\n    }\r\n\r\n    /**\r\n     * 设置顶牌\r\n     */\r\n    public set topCard(card: CardModel) {\r\n        this._topCard = card;\r\n    }\r\n\r\n    /**\r\n     * 获取备用牌\r\n     */\r\n    public get reserveCards(): CardModel[] {\r\n        return this._reserveCards;\r\n    }\r\n\r\n    /**\r\n     * 设置备用牌\r\n     */\r\n    public set reserveCards(cards: CardModel[]) {\r\n        this._reserveCards = cards;\r\n    }\r\n\r\n    /**\r\n     * 更新顶牌和备用牌\r\n     * 顶牌是最后移动到顶牌位置的卡牌，备用牌是关卡开始时除了顶牌的所有牌\r\n     */\r\n    public updateTopAndReserveCards(): void {\r\n        // 顶牌已经通过setTopCard方法设置，这里不需要重新计算\r\n        // 备用牌是初始备用牌，固定不变\r\n        console.log('updateTopAndReserveCards 被调用');\r\n        console.log(`当前顶牌: ${this._topCard ? this._topCard.config.CardFace : '无'}`);\r\n        console.log(`初始备用牌数量: ${this._initialReserveCards.length}`);\r\n        this._initialReserveCards.forEach((card, index) => {\r\n            console.log(`初始备用牌[${index}]: ${card.config.CardSuit}${card.config.CardFace}`);\r\n        });\r\n\r\n        // 备用牌是初始备用牌，固定不变\r\n        this._reserveCards = [...this._initialReserveCards];\r\n        console.log(`更新后备用牌数量: ${this._reserveCards.length}`);\r\n    }\r\n\r\n    /**\r\n     * 判断两张牌是否可以匹配（点数绝对值差1）\r\n     */\r\n    public canMatch(tableCard: CardModel, handCard: CardModel): boolean {\r\n        return Math.abs(tableCard.config.CardFace - handCard.config.CardFace) === 1;\r\n    }\r\n\r\n    /**\r\n     * 执行匹配操作\r\n     * @param tableCardId 桌面卡牌ID\r\n     * @returns 是否成功匹配\r\n     */\r\n    public executeMatch(tableCardId: string): boolean {\r\n        const tableCard = this._allCards.get(tableCardId);\r\n        const handCard = this.getLastHandCard();\r\n\r\n        if (!tableCard || !handCard) return false;\r\n        if (tableCard.currentArea !== 'table') return false;\r\n        if (!this.canMatch(tableCard, handCard)) return false;\r\n\r\n        // 更新桌面卡牌为手牌最后一张\r\n        tableCard.config.CardFace = handCard.config.CardFace;\r\n        tableCard.config.CardSuit = handCard.config.CardSuit;\r\n\r\n        // 移除手牌最后一张\r\n        this._handCards.delete(handCard.id);\r\n        this._allCards.delete(handCard.id);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 替换手牌最后一张\r\n     * @param cardId 要替换的卡牌ID\r\n     * @returns 是否成功替换\r\n     */\r\n    public replaceLastHandCard(cardId: string): boolean {\r\n        const card = this._allCards.get(cardId);\r\n        if (!card || card.currentArea !== 'hand') return false;\r\n\r\n        const cards = Array.from(this._handCards.values());\r\n        const lastIndex = cards.length - 1;\r\n        const lastCard = cards[lastIndex];\r\n\r\n        if (lastCard.id === cardId) return false; // 已经是最后一张\r\n\r\n        // 交换位置（通过调整zIndex实现）\r\n        const tempZIndex = card.zIndex;\r\n        card.zIndex = lastCard.zIndex;\r\n        lastCard.zIndex = tempZIndex;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 获取所有卡牌的状态\r\n     */\r\n    public getAllCardsState(): Map<string, CardState> {\r\n        const states = new Map<string, CardState>();\r\n        this._allCards.forEach((card, id) => {\r\n            states.set(id, {\r\n                id: card.id,\r\n                face: card.config.CardFace,\r\n                suit: card.config.CardSuit,\r\n                isFaceUp: card.isFaceUp,\r\n                isLocked: card.isLocked,\r\n                area: card.currentArea,\r\n                position: { ...card.position },\r\n                zIndex: card.zIndex\r\n            });\r\n        });\r\n        return states;\r\n    }\r\n\r\n    /**\r\n     * 恢复所有卡牌的状态\r\n     */\r\n    public restoreAllCardsState(states: Map<string, CardState>): void {\r\n        states.forEach((state, id) => {\r\n            const card = this._allCards.get(id);\r\n            if (card) {\r\n                card.config.CardFace = state.face;\r\n                card.config.CardSuit = state.suit;\r\n                card.isFaceUp = state.isFaceUp;\r\n                card.isLocked = state.isLocked;\r\n                card.currentArea = state.area;\r\n                card.position = { ...state.position };\r\n                card.zIndex = state.zIndex;\r\n\r\n                // 根据区域更新Map\r\n                if (state.area === 'table') {\r\n                    this._tableCards.set(id, card);\r\n                    this._handCards.delete(id);\r\n                } else if (state.area === 'hand') {\r\n                    this._handCards.set(id, card);\r\n                    this._tableCards.delete(id);\r\n                }\r\n            }\r\n        });\r\n        \r\n        // 恢复后重新计算顶牌和备用牌\r\n        this.recalculateTopAndReserveCards();\r\n    }\r\n    \r\n    /**\r\n     * 重新计算顶牌和备用牌\r\n     */\r\n    private recalculateTopAndReserveCards(): void {\r\n        const handCards = Array.from(this._handCards.values());\r\n        \r\n        // 按zIndex排序\r\n        handCards.sort((a, b) => a.zIndex - b.zIndex);\r\n        \r\n        if (handCards.length > 0) {\r\n            // 最后一张是顶牌\r\n            this._topCard = handCards[handCards.length - 1];\r\n            // 其余的是备用牌\r\n            this._reserveCards = handCards.slice(0, handCards.length - 1);\r\n        } else {\r\n            this._topCard = null;\r\n            this._reserveCards = [];\r\n        }\r\n        \r\n        console.log(`重新计算顶牌和备用牌 - 顶牌: ${this._topCard ? this._topCard.config.CardSuit + this._topCard.config.CardFace : '无'}, 备用牌数量: ${this._reserveCards.length}`);\r\n    }\r\n}\r\n"]}